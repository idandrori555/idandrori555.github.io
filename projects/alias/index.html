<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:;base64,=">
  <title>Alias - The Digital Game</title>
  <!-- ×˜×¢×™× ×ª Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ×”×’×“×¨×ª ×¤×•× ×˜ Inter ×’×œ×•×‘×œ×™ ×•×”×ª×××•×ª ×‘×¡×™×¡×™×•×ª ×œ-Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'celebrate': 'celebrate 1.5s ease-out infinite',
          },
          keyframes: {
            celebrate: {
              '0%, 100%': {
                transform: 'scale(1)',
                filter: 'drop-shadow(0 0 5px rgba(251, 191, 36, 0.5))'
              },
              '50%': {
                transform: 'scale(1.03)',
                filter: 'drop-shadow(0 0 15px rgba(251, 191, 36, 0.9))'
              },
            }
          }
        }
      }
    }
  </script>
  <style>
    /* ×”×’×“×¨×ª ×’×œ×™×œ×” ×—×œ×§×” ×•×ª×¦×•×’×ª ×¤×•× ×˜ */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0d121c;
      /* ×’×•×•×Ÿ ×›×”×” ×™×•×ª×¨ - ×›×—×•×œ-××¤×•×¨ ×¢××•×§ */
      text-align: right;
      transition: background-color 0.5s ease;
    }

    .game-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    /* ×”×ª×××” ×œ××›×©×™×¨×™× × ×™×™×“×™× */
    @media (max-width: 640px) {
      .main-word {
        font-size: 3.5rem;
        /* ×”×’×“×œ×ª ×”××™×œ×” ×”××¨×›×–×™×ª ×‘××•×‘×™×œ */
      }
    }

    /* Hide arrows from number inputs */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    /* ×©×™×¤×•×¨ × ×’×™×¢×” ×•×”×¦×œ×œ×” ×œ×›×¤×ª×•×¨×™× */
    button {
      transition: all 0.2s ease-in-out;
    }

    /* --- ×× ×™××¦×™×•×ª ×œ×©×™× ×•×™ × ×™×§×•×“ --- */

    @keyframes scoreUp {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }

      50% {
        transform: scale(1.15);
        opacity: 1;
        color: #4ade80;
        /* Tailwind green-400 */
        text-shadow: 0 0 10px rgba(74, 222, 128, 0.7);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes scoreDown {
      0% {
        transform: translate(0);
        opacity: 0.8;
      }

      25% {
        transform: translate(-5px, 0) scale(0.95);
        color: #f87171;
        /* Tailwind red-400 */
        text-shadow: 0 0 8px rgba(248, 113, 113, 0.7);
      }

      75% {
        transform: translate(5px, 0) scale(0.95);
      }

      100% {
        transform: translate(0);
        opacity: 1;
      }
    }

    .score-up {
      animation: scoreUp 0.5s ease-out;
    }

    .score-down {
      animation: scoreDown 0.5s ease-out;
    }
  </style>
</head>

<body class="bg-gray-950 text-gray-200">
  <div id="app" class="game-container">
    <!-- ×ª×•×›×Ÿ ×”××¤×œ×™×§×¦×™×” ×™×˜×¢×Ÿ ×›××Ÿ -->
  </div>

  <script src="hebrew_words.js"></script>
  <script>
    // ×”×’×“×¨×ª ×‘×¨×™×¨×ª ×”××—×“×œ ×œ××©×š ×¡×™×‘×•×‘
    const DEFAULT_ROUND_DURATION = 60;

    // ××¦×‘×™ ×”××©×—×§
    const GAME_STATE = {
      SETUP: 'SETUP',
      BOARD: 'BOARD',
      ROUND: 'ROUND',
      LAST_GUESS: 'LAST_GUESS',
      SUMMARY: 'SUMMARY',
      GAME_OVER: 'GAME_OVER',
      MANAGE_SETS: 'MANAGE_SETS'
    };

    // ××¦×‘ ×”××©×—×§ ×”×’×œ×•×‘×œ×™
    let gameState = {
      currentScreen: GAME_STATE.SETUP,
      teams: [],
      currentTeamIndex: 0,
      winningScore: 70, // × ×™×§×•×“ ×”× ×™×¦×—×•×Ÿ × ×›× ×¡ ×œ××¦×‘ ×”××©×—×§
      roundDuration: DEFAULT_ROUND_DURATION, // ××©×š ×”×¡×™×‘×•×‘ ×”××•×’×“×¨
      currentRound: {
        presenterIndex: 0,
        score: 0,
        timeLeft: DEFAULT_ROUND_DURATION,
        currentWord: '',
      },
      timerInterval: null,
      // totalWords ××›×™×œ ××ª ×¨×©×™××ª ×”××™×œ×™× ×©×¢×“×™×™×Ÿ ×œ× × ×¢×©×” ×‘×”×Ÿ ×©×™××•×© ×‘××©×—×§ ×”× ×•×›×—×™.
      totalWords: [...HEBREW_WORDS],
      // ×©× ×¢×¨×›×ª ×”××™×œ×™× ×”×¤×¢×™×œ×”
      activeWordSet: '×‘×¨×™×¨×ª ××—×“×œ',
    };

    // --- × ×™×”×•×œ ×¢×¨×›×•×ª ××™×œ×™× ×‘-LocalStorage ---

    const CUSTOM_SETS_STORAGE_KEY = 'aliasCustomWordSets';

    // ×§×‘×œ×ª ×›×œ ×”×¢×¨×›×•×ª ×”××•×ª×××•×ª ××™×©×™×ª ××”××—×¡×•×Ÿ
    function getCustomWordSets() {
      try {
        const sets = localStorage.getItem(CUSTOM_SETS_STORAGE_KEY);
        return sets ? JSON.parse(sets) : {};
      } catch (e) {
        console.error("Error reading custom word sets from localStorage", e);
        return {};
      }
    }

    // ×©××™×¨×ª ×›×œ ×”×¢×¨×›×•×ª ×”××•×ª×××•×ª ××™×©×™×ª ×‘××—×¡×•×Ÿ
    function saveCustomWordSets(sets) {
      try {
        localStorage.setItem(CUSTOM_SETS_STORAGE_KEY, JSON.stringify(sets));
      } catch (e) {
        console.error("Error saving custom word sets to localStorage", e);
      }
    }


    // --- ×œ×•×’×™×§×ª ××ª×—×•×œ ×•××™××•×ª ×§×œ×˜ ---

    // ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×” ×•×”×¦×’×ª ××¡×š ×”×”×’×“×¨×•×ª
    function initApp() {
      gameState.currentScreen = GAME_STATE.SETUP;
      render();
    }

    // ××™×¤×•×¡ ××œ× ×©×œ ××¦×‘ ×”××©×—×§
    function resetGame() {
      // ×× ×™×© ×˜×™×™××¨ ×¨×¥, ×¢×¦×•×¨ ××•×ª×•
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      // ××™×¤×•×¡ ×”××¦×‘ ×ª×•×š ×©××™×¨×” ×¢×œ ×”×¢×¨×›×™× ×”××—×¨×•× ×™× ×©×”×•×’×“×¨×• (× ×™×§×•×“ ×•××©×š ×¡×™×‘×•×‘)
      gameState = {
        currentScreen: GAME_STATE.SETUP,
        teams: [],
        currentTeamIndex: 0,
        // ×©×•××¨×™× ×¢×œ ×”×¢×¨×›×™× ×©×”×•×’×“×¨×• ×œ××—×¨×•× ×” ××• ×‘×¨×™×¨×ª ×”××—×“×œ
        winningScore: gameState.winningScore || 70,
        roundDuration: gameState.roundDuration || DEFAULT_ROUND_DURATION,
        currentRound: {
          presenterIndex: 0,
          score: 0,
          // ××ª×—×•×œ ××—×“×© ×¢× ××©×š ×”×¡×™×‘×•×‘ ×”× ×•×›×—×™
          timeLeft: gameState.roundDuration || DEFAULT_ROUND_DURATION,
          currentWord: '',
        },
        timerInterval: null,
        totalWords: [...HEBREW_WORDS],
      };

      // ×¢×•×‘×¨×™× ×œ××¡×š ×”×”×’×“×¨×•×ª
      render();
    }

    // --- ×œ×•×’×™×§×ª ×”×’×“×¨×ª ××©×—×§ (SETUP) ---

    // ××™××•×ª ×•×”×ª×—×œ×ª ×”××©×—×§
    function startSetup() {
      const teamNames = document.getElementById('teamNames');
      const winningScoreInput = document.getElementById('winningScore');
      const roundDurationInput = document.getElementById('roundDuration');
      const setupErrorElement = document.getElementById('setupError');
      const wordSetSelect = document.getElementById('wordSet');

      const selectedWordSet = wordSetSelect.value;
      let wordsForGame = [];

      if (selectedWordSet === '×‘×¨×™×¨×ª ××—×“×œ') {
        wordsForGame = [...HEBREW_WORDS];
      } else {
        const customSets = getCustomWordSets();
        wordsForGame = [...(customSets[selectedWordSet] || [])];
      }

      if (wordsForGame.length === 0) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "×¢×¨×›×ª ×”××™×œ×™× ×©× ×‘×—×¨×” ×¨×™×§×”. ×× × ×‘×—×¨ ×¢×¨×›×” ××—×¨×ª ××• ×”×•×¡×£ ××™×œ×™×.";
        return;
      }

      const namesArray = teamNames.value.split('\n').map(name => name.trim()).filter(name => name);
      const teamCount = namesArray.length;
      const scoreToWin = parseInt(winningScoreInput.value, 10);
      const duration = parseInt(roundDurationInput.value, 10);

      // ××™××•×ª ×‘×¡×™×¡×™
      if (teamCount < 2) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "×× × ×”×–×Ÿ ×œ×¤×—×•×ª 2 ×©××•×ª ×©×œ ×§×‘×•×¦×•×ª (××—×ª ×œ×©×•×¨×”).";
        return;
      }
      if (scoreToWin < 1 || isNaN(scoreToWin)) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "× ×™×§×•×“ ×”× ×™×¦×—×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ××¡×¤×¨ ×—×™×•×‘×™.";
        return;
      }
      if (duration < 10 || isNaN(duration)) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "××©×š ×”×¡×™×‘×•×‘ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 10 ×©× ×™×•×ª.";
        return;
      }

      setupErrorElement.textContent = "";

      gameState.winningScore = scoreToWin;
      gameState.roundDuration = duration;
      gameState.activeWordSet = selectedWordSet;
      gameState.totalWords = wordsForGame;

      // ×™×¦×™×¨×ª ××¢×¨×š ×”×§×‘×•×¦×•×ª
      gameState.teams = [];
      for (let i = 0; i < teamCount; i++) {
        gameState.teams.push({
          name: namesArray[i],
          score: 0,
          players: [`×©×—×§×Ÿ 1`, `×©×—×§×Ÿ 2`],
          presenterIndex: 0
        });
      }

      gameState.currentScreen = GAME_STATE.BOARD;
      render();
    }

    // --- ×œ×•×’×™×§×ª ×œ×•×— ×”××©×—×§ (BOARD) ---

    // ×”×¤×¢×œ×ª ×¡×™×‘×•×‘ ×—×“×©
    function startNewRound() {
      if (gameState.teams.length === 0) return;

      // ××ª×—×•×œ × ×ª×•× ×™ ×”×¡×™×‘×•×‘
      gameState.currentRound.score = 0;
      // ×©×™××•×© ×‘××©×š ×”×¡×™×‘×•×‘ ×”××•×’×“×¨
      gameState.currentRound.timeLeft = gameState.roundDuration;
      gameState.currentWord = '';

      // ×”×’×“×¨×ª ×”×©×—×§×Ÿ ×”××¦×™×’ ×”× ×•×›×—×™
      const currentTeam = gameState.teams[gameState.currentTeamIndex];
      const nextPresenterIndex = currentTeam.presenterIndex;
      currentTeam.presenterIndex = (currentTeam.presenterIndex + 1) % currentTeam.players.length;

      gameState.currentScreen = GAME_STATE.ROUND;
      getNewWord();
      startTimer();
      render();
    }

    // --- ×œ×•×’×™×§×ª ×¡×™×‘×•×‘ (ROUND) ---

    // ×‘×—×™×¨×ª ××™×œ×” ×—×“×©×”
    function getNewWord() {
      // 1. ×× × ×’××¨×• ×›×œ ×”××™×œ×™×, ××™×Ÿ ××¤×©×¨×•×ª ×œ×”××©×™×š ××ª ×”×¡×™×‘×•×‘
      if (gameState.totalWords.length === 0) {
        // ×”×¦×’×ª ×”×•×“×¢×” ×œ××©×ª××© ×•×¡×™×•× ×”×¡×™×‘×•×‘
        alert("×›×œ ×”××™×œ×™× ×‘×¢×¨×›×” × ×•×¦×œ×•! ×”×¡×™×‘×•×‘ ×”× ×•×›×—×™ ×™×¡×ª×™×™×.");
        endRound(); // ×§×•×¨× ×œ×¡×™×•× ×”×¡×™×‘×•×‘
        return; // ×¢×•×¦×¨ ××ª ×”×¤×•× ×§×¦×™×” ×›×“×™ ×œ× ×œ×”××©×™×š
      }

      // 2. ×‘×—×™×¨×ª ××™×œ×” ××§×¨××™×ª ××”×××’×¨ ×©× ×•×ª×¨
      const randomIndex = Math.floor(Math.random() * gameState.totalWords.length);
      const newWord = gameState.totalWords[randomIndex];

      // 3. ×”×’×“×¨×ª ×”××™×œ×” ×”× ×•×›×—×™×ª
      gameState.currentRound.currentWord = newWord;

      // 4. ×”×¡×¨×ª ×”××™×œ×” ××”×××’×¨ ×”×’×œ×•×‘×œ×™ ×›×“×™ ×œ×× ×•×¢ ×©×™××•×© ×—×•×–×¨ ×‘××©×—×§ ×–×”
      gameState.totalWords.splice(randomIndex, 1);

      // 5. ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
      if (gameState.currentScreen === GAME_STATE.ROUND) {
        const wordElement = document.getElementById('currentWordDisplay');
        if (wordElement) {
          wordElement.textContent = newWord;
        }
      }
    }

    // ×”×¤×¢×œ×ª ×©×¢×•×Ÿ ×”×¢×¦×¨
    function startTimer() {
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      gameState.timerInterval = setInterval(() => {
        gameState.currentRound.timeLeft--;
        const timerElement = document.getElementById('timerDisplay');
        if (timerElement) {
          timerElement.textContent = gameState.currentRound.timeLeft;

          // ×œ×•×’×™×§×” ×œ×©×™× ×•×™ ×¦×‘×¢ ×•×”×‘×”×•×‘ ×›×©×”×–××Ÿ × ×’××¨
          if (gameState.currentRound.timeLeft <= 10) {
            timerElement.classList.add('text-red-400', 'animate-pulse');
            timerElement.classList.remove('text-indigo-400', 'text-gray-200');
          } else {
            timerElement.classList.remove('text-red-400', 'animate-pulse');
            timerElement.classList.add('text-indigo-400');
          }
        }

        if (gameState.currentRound.timeLeft <= 0) {
          clearInterval(gameState.timerInterval);
          gameState.currentScreen = GAME_STATE.LAST_GUESS;
          render();
        }
      }, 1000);
    }

    // ×¢×“×›×•×Ÿ × ×™×§×•×“ ×‘××”×œ×š ×”×¡×™×‘×•×‘
    function handleGuess(type) {
      const currentTeam = gameState.teams[gameState.currentTeamIndex];
      const roundScoreElement = document.getElementById('roundScoreDisplay');

      if (type === 'success') {
        gameState.currentRound.score++;
        currentTeam.score++; // ×¢×“×›×•×Ÿ ××™×™×“×™ ×©×œ ×”× ×™×§×•×“ ×”×’×œ×•×‘×œ×™ ×œ×”×ª×§×“××•×ª ×‘×œ×•×—

        // ×”×¤×¢×œ×ª ×× ×™××¦×™×™×ª ×”×¦×œ×—×”
        if (roundScoreElement) {
          roundScoreElement.classList.remove('score-down', 'text-red-400', 'text-green-400');
          roundScoreElement.classList.add('score-up', 'text-green-400');
          setTimeout(() => {
            roundScoreElement.classList.remove('score-up');
            // ×¢×“×›×•×Ÿ ×¦×‘×¢ ×¨×’×™×œ ×œ××—×¨ ×”×× ×™××¦×™×”, ×›×“×™ ×œ×©××•×¨ ×¢×œ ×”××“×•× ×× ×”× ×™×§×•×“ ×©×œ×™×œ×™
            if (gameState.currentRound.score < 0) {
              roundScoreElement.classList.add('text-red-400');
            } else {
              roundScoreElement.classList.add('text-green-400');
            }
          }, 500); // ××©×š ×”×× ×™××¦×™×”
        }

        getNewWord();
      } else if (type === 'skip') {
        // ×“×™×œ×•×’ ××• ×¤×¡×™×œ×” ××¤×—×™×ª×™× × ×§×•×“×” (×›×•×œ×œ × ×™×§×•×“ ×©×œ×™×œ×™)
        gameState.currentRound.score--;
        currentTeam.score--;

        // ×”×¤×¢×œ×ª ×× ×™××¦×™×™×ª ×›×™×©×œ×•×Ÿ
        if (roundScoreElement) {
          roundScoreElement.classList.remove('score-up', 'text-green-400', 'text-red-400');
          roundScoreElement.classList.add('score-down', 'text-red-400');
          setTimeout(() => {
            roundScoreElement.classList.remove('score-down');
            // ×¢×“×›×•×Ÿ ×¦×‘×¢ ×¨×’×™×œ ×œ××—×¨ ×”×× ×™××¦×™×”
            if (gameState.currentRound.score < 0) {
              roundScoreElement.classList.add('text-red-400');
            } else {
              roundScoreElement.classList.add('text-green-400');
            }
          }, 500); // ××©×š ×”×× ×™××¦×™×”
        }

        getNewWord();
      }

      // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª × ×™×§×•×“ ×”×¡×™×‘×•×‘ (×—×•×‘×” ×œ×¤× ×™ ×‘×“×™×§×ª × ×™×¦×—×•×Ÿ/×¢×“×›×•×Ÿ ×œ×•×—)
      if (roundScoreElement) {
        roundScoreElement.textContent = gameState.currentRound.score;
      }


      // ×‘×“×™×§×ª × ×™×¦×—×•×Ÿ ××™×™×“×™ (×× ×”× ×™×§×•×“ ×¢×‘×¨ ××ª ×¨×£ ×”× ×™×¦×—×•×Ÿ)
      if (currentTeam.score >= gameState.winningScore) {
        clearInterval(gameState.timerInterval);
        gameState.currentScreen = GAME_STATE.GAME_OVER;
        render();
        return;
      }

      // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×”×œ×•×— ×‘×¨×§×¢
      renderBoard();
    }

    // ×¡×™×•× ×”×¡×™×‘×•×‘
    function endRound() {
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      // ×‘×“×™×§×ª × ×™×¦×—×•×Ÿ
      const currentTeam = gameState.teams[gameState.currentTeamIndex];
      // ×‘×“×™×§×ª ×”× ×™×¦×—×•×Ÿ ×œ× ××©×ª× ×” - ×¢×“×™×™×Ÿ ×¦×¨×™×š ×œ×¢×‘×•×¨ ××ª × ×™×§×•×“ ×”× ×™×¦×—×•×Ÿ (×—×™×•×‘×™)
      if (currentTeam.score >= gameState.winningScore) {
        gameState.currentScreen = GAME_STATE.GAME_OVER;
      } else {
        gameState.currentScreen = GAME_STATE.SUMMARY;
      }
      render();
    }

    // --- ×œ×•×’×™×§×ª ×¡×™×›×•× ×¡×™×‘×•×‘ (SUMMARY) ×•×—×™×œ×•×£ ×ª×•×¨ ---

    // ×˜×™×¤×•×œ ×‘× ×™×—×•×© ×”××—×¨×•×Ÿ ×•×¡×™×•× ×”×¡×™×‘×•×‘
    function handleFinalGuess(teamIndex) {
      // ×× × ×‘×—×¨×” ×§×‘×•×¦×”, ×”×•×¡×£ ×œ×” × ×§×•×“×”
      if (teamIndex >= 0 && teamIndex < gameState.teams.length) {
        const guessingTeam = gameState.teams[teamIndex];
        guessingTeam.score++;

        // ×‘×“×™×§×ª × ×™×¦×—×•×Ÿ ××™×™×“×™×ª ×¢×‘×•×¨ ×”×§×‘×•×¦×” ×©× ×™×—×©×”
        if (guessingTeam.score >= gameState.winningScore) {
          gameState.currentTeamIndex = teamIndex; // ×§×•×‘×¢ ××ª ×”×§×‘×•×¦×” ×©× ×™×¦×—×” ×›× ×•×›×—×™×ª ×›×“×™ ×œ×”×¦×™×’ ××•×ª×” ×‘××¡×š ×”× ×™×¦×—×•×Ÿ
          gameState.currentScreen = GAME_STATE.GAME_OVER;
          render();
          return; // ×¡×™×™× ××ª ×”×¤×•× ×§×¦×™×” ×›××Ÿ
        }
      }

      // ×× ××£ ××—×“ ×œ× × ×™×¦×— ××”× ×™×—×•×© ×”××—×¨×•×Ÿ, ×‘×“×•×§ ×× ×”×§×‘×•×¦×” ×”××§×•×¨×™×ª × ×™×¦×—×” ×‘××”×œ×š ×”×¡×™×‘×•×‘
      const originalTeam = gameState.teams[gameState.currentTeamIndex];
      if (originalTeam.score >= gameState.winningScore) {
        gameState.currentScreen = GAME_STATE.GAME_OVER;
      } else {
        // ××—×¨×ª, ×¢×‘×•×¨ ×œ××¡×š ×”×¡×™×›×•×
        gameState.currentScreen = GAME_STATE.SUMMARY;
      }
      render();
    }

    // ×”×¢×‘×¨×ª ×”×ª×•×¨ ×œ×§×‘×•×¦×” ×”×‘××”
    function nextTurn() {
      // ×× ×™×© ×¨×§ ×§×‘×•×¦×” ××—×ª (×œ× ×××•×¨ ×œ×§×¨×•×ª ×‘×’×œ×œ ×”××™××•×ª) ××• ×©×”×’×¢× ×• ×œ×¡×•×£, ×—×•×–×¨×™× ×œ×”×ª×—×œ×”
      gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length;
      gameState.currentScreen = GAME_STATE.BOARD;
      render();
    }

    // --- ×¤×•× ×§×¦×™×•×ª ×¨×™× ×“×•×¨ (Rendering) ---

    function getCurrentTeam() {
      return gameState.teams[gameState.currentTeamIndex];
    }

    // ××¢×‘×¨ ×œ××¡×š × ×™×”×•×œ ×¢×¨×›×•×ª
    function showManageSetsScreen() {
      gameState.currentScreen = GAME_STATE.MANAGE_SETS;
      render();
    }

    // ×©××™×¨×” ××• ×¢×“×›×•×Ÿ ×©×œ ×¢×¨×›×”
    function saveOrUpdateSet() {
      const setNameInput = document.getElementById('setName');
      const wordsTextarea = document.getElementById('wordsTextarea');
      const setName = setNameInput.value.trim();
      const words = wordsTextarea.value.split('\n').map(w => w.trim()).filter(Boolean);

      if (!setName || words.length === 0) {
        alert('×™×© ×œ×¡×¤×§ ×©× ×œ×¢×¨×›×” ×•×œ×¤×—×•×ª ××™×œ×” ××—×ª.');
        return;
      }

      const customSets = getCustomWordSets();
      customSets[setName] = words;
      saveCustomWordSets(customSets);

      // ×—×–×¨×” ×œ××¡×š ×”×”×’×“×¨×•×ª
      gameState.currentScreen = GAME_STATE.SETUP;
      render();
    }

    // ××—×™×§×ª ×¢×¨×›×”
    function deleteSet(setName) {
      if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×¢×¨×›×” "${setName}"?`)) {
        return;
      }

      const customSets = getCustomWordSets();
      delete customSets[setName];
      saveCustomWordSets(customSets);

      // ×”×™×©××¨×• ×‘××•×ª×• ××¡×š ×•×¨× ×“×¨×• ××—×“×©
      render();
    }

    // ×˜×¢×™× ×ª ×¢×¨×›×” ×œ×¢×¨×™×›×”
    function loadSetForEditing(setName) {
      const customSets = getCustomWordSets();
      const words = customSets[setName];

      if (words) {
        document.getElementById('setName').value = setName;
        document.getElementById('wordsTextarea').value = words.join('\n');
      }
    }

    // ×¨×™× ×“×•×¨ ×œ×•×— ×”××©×—×§ (×˜×‘×œ×ª × ×™×§×•×“)
    function renderBoard() {
      const boardContainer = document.getElementById('boardContainer');
      if (!boardContainer) return;

      const boardHTML = `
                <div class="space-y-4">
                    ${gameState.teams.map((team, index) => {
        // ×§×‘×™×¢×ª ×¦×‘×¢ ×”× ×™×§×•×“: ×¦×”×•×‘ ×œ× ×™×¦×—×•×Ÿ, ××“×•× ×œ×©×œ×™×œ×™, ×›×—×•×œ ×œ× ×™×§×•×“ ×¨×’×™×œ
        const scoreTextColor = team.score >= gameState.winningScore
          ? 'text-yellow-400'
          : (team.score < 0 ? 'text-red-400' : 'text-blue-400');

        return `
                        <div class="flex items-center justify-between p-5 rounded-xl shadow-xl transition duration-300 ${index === gameState.currentTeamIndex ? 'bg-indigo-900/50 border-4 border-indigo-400 transform scale-[1.02] shadow-indigo-500/50' : 'bg-gray-800 border border-gray-700 hover:bg-gray-700/50'}">
                            <div class="flex flex-col">
                                <span class="text-xl font-bold ${index === gameState.currentTeamIndex ? 'text-indigo-300' : 'text-gray-300'}">${team.name}</span>
                                <span class="text-sm text-gray-400 mt-1">×”××¦×™×’ ×”×‘×: ${team.players[team.presenterIndex]}</span>
                            </div>
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <span class="text-4xl font-extrabold ${scoreTextColor}">${team.score}</span>
                            </div>
                        </div>
                      `;
      }).join('')}
                </div>
            `;
      boardContainer.innerHTML = boardHTML;
    }


    // ×¨×™× ×“×•×¨ ×‘×”×ª×× ×œ××¦×‘ ×”××©×—×§
    function render() {
      const appDiv = document.getElementById('app');
      let content = '';

      const currentTeam = getCurrentTeam();
      const nextPresenterName = currentTeam ? currentTeam.players[currentTeam.presenterIndex] : '';

      switch (gameState.currentScreen) {
        case GAME_STATE.SETUP:
          const customSets = getCustomWordSets();
          const setNames = Object.keys(customSets);

          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10">
                            <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400 mb-8 text-center border-b border-gray-700 pb-3">
                                ××œ×™××¡
                            </h1>
                            
                            <div class="space-y-6">
                                <!-- ×‘×—×™×¨×ª ×¢×¨×›×ª ××™×œ×™× -->
                                <div class="mb-4">
                                    <label for="wordSet" class="block text-sm font-medium text-gray-300 mb-2">×‘×—×¨ ×¢×¨×›×ª ××™×œ×™×:</label>
                                    <div class="flex gap-2">
                                        <select id="wordSet" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white">
                                            <option value="×‘×¨×™×¨×ª ××—×“×œ">×‘×¨×™×¨×ª ××—×“×œ (×¢×‘×¨×™×ª)</option>
                                            ${setNames.map(name => `<option value="${name}" ${gameState.activeWordSet === name ? 'selected' : ''}>${name}</option>`).join('')}
                                        </select>
                                        <button onclick="showManageSetsScreen()" class="p-3 bg-gray-600 text-white rounded-xl hover:bg-gray-500 transition duration-200" title="× ×”×œ ×¢×¨×›×•×ª ××™×œ×™×">âš™ï¸</button>
                                    </div>
                                </div>

                                <!-- × ×™×§×•×“ × ×“×¨×© ×œ× ×™×¦×—×•×Ÿ -->
                                <div class="mb-4">
                                    <label for="winningScore" class="block text-sm font-medium text-gray-300 mb-2">× ×™×§×•×“ × ×“×¨×© ×œ× ×™×¦×—×•×Ÿ:</label>
                                    <input type="number" id="winningScore" value="${gameState.winningScore}" min="1" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white" aria-label="× ×™×§×•×“ × ×“×¨×© ×œ× ×™×¦×—×•×Ÿ">
                                </div>
                                
                                <!-- ××©×š ×¡×™×‘×•×‘ -->
                                <div class="mb-4">
                                    <label for="roundDuration" class="block text-sm font-medium text-gray-300 mb-2">××©×š ×¡×™×‘×•×‘ (×©× ×™×•×ª):</label>
                                    <input type="number" id="roundDuration" value="${gameState.roundDuration}" min="10" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white" aria-label="××©×š ×¡×™×‘×•×‘ ×‘×©× ×™×•×ª">
                                </div>

                                <!-- ×©××•×ª ×”×§×‘×•×¦×•×ª -->
                                <div class="mb-6">
                                    <label for="teamNames" class="block text-sm font-medium text-gray-300 mb-2">×©××•×ª ×”×§×‘×•×¦×•×ª (×”×–×Ÿ ×©× ××—×“ ×‘×›×œ ×©×•×¨×”):</label>
                                    <textarea id="teamNames" rows="4" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white placeholder-gray-400" placeholder="×§×‘×•×¦×ª ×”×¤× ×ª×¨×™×\n×§×‘×•×¦×ª ×”× ××¨×™×" aria-label="×©××•×ª ×”×§×‘×•×¦×•×ª"></textarea>
                                </div>
                            </div>

                            <p id="setupError" class="text-red-400 text-sm font-semibold mb-6 text-center bg-red-900/30 p-2 rounded-lg hidden"></p>
                            
                            <button onclick="startSetup()" class="w-full py-4 my-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-2xl shadow-lg hover:from-indigo-700 hover:to-purple-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.98] ring-2 ring-indigo-400">
                                ×”×ª×—×œ ××©×—×§
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.MANAGE_SETS:
          const existingSets = getCustomWordSets();
          content = `
            <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10">
              <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-cyan-400 mb-6 text-center border-b border-gray-700 pb-3">
                × ×™×”×•×œ ×¢×¨×›×•×ª ××™×œ×™×
              </h1>

              <!-- ×¨×©×™××ª ×¢×¨×›×•×ª ×§×™×™××•×ª -->
              <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-300 mb-3">×”×¢×¨×›×•×ª ×©×œ×™</h2>
                <div class="space-y-2">
                  ${Object.keys(existingSets).length > 0 ? Object.keys(existingSets).map(setName => `
                    <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                      <span class="font-semibold text-white">${setName}</span>
                      <div class="flex gap-2">
                        <button onclick="loadSetForEditing('${setName}')" class="text-sm bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded-md transition">×¢×¨×•×š</button>
                        <button onclick="deleteSet('${setName}')" class="text-sm bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-md transition">××—×§</button>
                      </div>
                    </div>
                  `).join('') : '<p class="text-gray-400 text-center">×¢×“×™×™×Ÿ ×œ× ×™×¦×¨×ª ×¢×¨×›×•×ª ××™×œ×™×.</p>'}
                </div>
              </div>

              <!-- ×˜×•×¤×¡ ×™×¦×™×¨×”/×¢×¨×™×›×” -->
              <div class="space-y-4 pt-4 border-t border-gray-700">
                <h2 class="text-xl font-bold text-gray-300">×™×¦×™×¨×” / ×¢×¨×™×›×ª ×¢×¨×›×”</h2>
                <div>
                  <label for="setName" class="block text-sm font-medium text-gray-300 mb-2">×©× ×”×¢×¨×›×”:</label>
                  <input type="text" id="setName" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-xl focus:ring-teal-500 focus:border-teal-500 text-white" placeholder="×œ×“×•×’××”: ×¡×¨×˜×™× ×•×¡×“×¨×•×ª">
                </div>
                <div>
                  <label for="wordsTextarea" class="block text-sm font-medium text-gray-300 mb-2">×¨×©×™××ª ××™×œ×™× (××—×ª ×‘×›×œ ×©×•×¨×”):</label>
                  <textarea id="wordsTextarea" rows="6" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-xl focus:ring-teal-500 focus:border-teal-500 text-white" placeholder="×”××¨×™ ×¤×•×˜×¨\n×©×¨ ×”×˜×‘×¢×•×ª\n..."></textarea>
                </div>
                <button onclick="saveOrUpdateSet()" class="w-full py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold rounded-xl shadow-lg hover:from-teal-600 hover:to-cyan-600 transition">
                  ×©××•×¨ ×¢×¨×›×”
                </button>
              </div>
              
              <button onclick="initApp()" class="w-full mt-6 py-2 bg-gray-600 text-gray-200 font-semibold rounded-xl hover:bg-gray-500 transition">
                ×—×–×•×¨ ×œ××¡×š ×”×¨××©×™
              </button>
            </div>
          `;
          break;

        case GAME_STATE.BOARD:
          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10">
                            <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-400 mb-6 text-center">ğŸ† ×œ×•×— ×”××©×—×§ ×”×“×™×’×™×˜×œ×™</h1>
                            
                            <div class="bg-indigo-900 p-5 rounded-2xl mb-8 border-l-8 border-indigo-400 shadow-xl shadow-indigo-900/50">
                                <p class="text-md text-indigo-300 font-medium">×ª×•×¨ × ×•×›×—×™:</p>
                                <p class="text-3xl font-black text-indigo-200">${currentTeam.name}</p>
                                <p class="text-md text-gray-300 mt-2">×”××¦×™×’ ×”×‘×: <span class="font-semibold text-white">${currentTeam.players[currentTeam.presenterIndex]}</span></p>
                            </div>

                            <h2 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">× ×™×§×•×“ (×™×¢×“: ${gameState.winningScore})</h2>
                            <div id="boardContainer" class="mb-8">
                                <!-- ×”×œ×•×— × ×˜×¢×Ÿ ×‘×××¦×¢×•×ª renderBoard() -->
                            </div>
                            
                            <button onclick="startNewRound()" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white font-extrabold rounded-2xl shadow-xl hover:from-emerald-600 hover:to-green-600 transition duration-300 transform hover:scale-[1.02] active:scale-[0.98] ring-4 ring-emerald-300/50">
                                ğŸš€ ×”×ª×—×œ ×¡×™×‘×•×‘ ×—×“×© (××©×š: ${gameState.roundDuration} ×©× ×™×•×ª)
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.ROUND:
          content = `
                        <div class="w-full max-w-lg p-6 bg-gray-900 border border-gray-700 rounded-3xl shadow-2xl mt-10 text-center">
                            <h1 class="text-2xl font-extrabold text-indigo-400 mb-4">×ª×•×¨ ×©×œ: ${currentTeam.name}</h1>
                            
                            <div class="grid grid-cols-2 gap-4 mb-6 p-4 bg-gray-800 rounded-2xl shadow-inner border border-gray-700">
                                <div class="p-2 border-l border-gray-700">
                                    <p class="text-base font-medium text-gray-400">×–××Ÿ ×©× ×•×ª×¨:</p>
                                    <p id="timerDisplay" class="text-6xl font-black text-indigo-400 transition-colors duration-200">${gameState.currentRound.timeLeft}</p>
                                </div>
                                <div class="p-2">
                                    <p class="text-base font-medium text-gray-400">× ×™×§×•×“ ×‘×¡×™×‘×•×‘:</p>
                                    <p id="roundScoreDisplay" class="text-6xl font-black ${gameState.currentRound.score < 0 ? 'text-red-400' : 'text-green-400'}">${gameState.currentRound.score}</p>
                                </div>
                            </div>
                            
                            <div class="my-8 p-10 bg-gradient-to-br from-indigo-700 to-purple-700 text-white rounded-3xl shadow-2xl transform hover:scale-105 transition duration-300 cursor-pointer shadow-indigo-500/50">
                                <p class="text-xl font-medium opacity-80 mb-2">×”××™×œ×” ×œ×”×¡×‘×¨:</p>
                                <p id="currentWordDisplay" class="main-word text-6xl md:text-6xl font-black tracking-wider">${gameState.currentRound.currentWord}</p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="handleGuess('success')" class="py-6 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-extrabold text-2xl rounded-2xl shadow-2xl hover:from-green-600 hover:to-emerald-600 transition duration-300 transform hover:scale-[1.05] active:scale-[1] ring-2 ring-green-300/50">
                                    ×”×¦×œ×™×—
                                </button>
                                <button onclick="handleGuess('skip')" class="py-6 bg-gradient-to-r from-red-500 to-pink-500 text-white font-extrabold text-2xl rounded-2xl shadow-2xl hover:from-red-600 hover:to-pink-600 transition duration-300 transform hover:scale-[1.05] active:scale-[1] ring-2 ring-red-300/50">
                                    ×“×™×œ×•×’ / ×¤×¡×™×œ×”
                                </button>
                            </div>

                            <button onclick="endRound()" class="w-full mt-6 py-3 bg-gray-700 text-gray-300 font-bold rounded-2xl hover:bg-gray-600 transition duration-300 shadow-md transform hover:scale-[1.01] active:scale-[0.99]">
                                ×¡×™×™× ×¡×™×‘×•×‘ ××•×§×“×
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.LAST_GUESS:
          content = `
            <div class="w-full max-w-lg p-8 bg-gray-800 border-2 border-yellow-500 rounded-3xl shadow-2xl mt-10 text-center">
                <h1 class="text-4xl font-extrabold text-yellow-400 mb-4">â° ×”×–××Ÿ × ×’××¨! â°</h1>
                <p class="text-lg text-gray-300 mb-4">×”×¡×™×‘×•×‘ ×”×¡×ª×™×™×. ×¢×“×™×™×Ÿ × ×•×ª×¨×” ××™×œ×” ××—×¨×•× ×” ×œ× ×—×©!</p>
                
                <div class="my-6 p-8 bg-gradient-to-br from-indigo-700 to-purple-700 text-white rounded-3xl shadow-xl">
                    <p id="currentWordDisplay" class="main-word text-6xl font-black tracking-wider">${gameState.currentRound.currentWord}</p>
                </div>

                <p class="text-xl font-semibold text-gray-300 mb-4">××™ × ×™×—×© × ×›×•×Ÿ ××ª ×”××™×œ×”?</p>
                
                <div class="space-y-3 mb-6">
                    ${gameState.teams.map((team, index) => `
                        <button onclick="handleFinalGuess(${index})" class="w-full py-3 text-lg font-bold text-white bg-blue-600 rounded-xl shadow-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                            ${team.name}
                        </button>
                    `).join('')}
                </div>

                <button onclick="handleFinalGuess(-1)" class="w-full py-3 bg-gray-600 text-gray-200 font-semibold rounded-xl hover:bg-gray-500 transition">
                    ××£ ××—×“ ×œ× × ×™×—×© / ×”××©×š
                </button>
            </div>
          `;
          break;

        case GAME_STATE.SUMMARY:
          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10 text-center">
                            <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400 mb-6 border-b border-gray-700 pb-2">ğŸ ×¡×™×›×•× ×¡×™×‘×•×‘!</h1>
                            
                            <div class="bg-gray-700 p-8 rounded-2xl mb-8 shadow-xl border-t-4 ${gameState.currentRound.score < 0 ? 'border-red-500' : 'border-green-500'}">
                                <p class="text-xl text-gray-300 mb-3">×”×§×‘×•×¦×” ×©×©×™×—×§×”: <span class="font-black text-indigo-400">${currentTeam.name}</span></p>
                                <p class="text-2xl font-bold text-gray-300 mb-4">× ×™×§×•×“ ×©× ×•×¡×£ ×‘×¡×™×‘×•×‘:</p>
                                <p class="text-8xl font-black ${gameState.currentRound.score < 0 ? 'text-red-400' : 'text-green-400'}">${gameState.currentRound.score}</p>
                            </div>

                            <h2 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">×”×ª×§×“××•×ª ×”×œ×•×—</h2>
                            <div id="boardContainer" class="mb-8">
                                <!-- ×”×œ×•×— × ×˜×¢×Ÿ ×‘×××¦×¢×•×ª renderBoard() -->
                            </div>

                            <button onclick="nextTurn()" class="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold rounded-2xl shadow-xl hover:from-blue-700 hover:to-cyan-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.98]">
                                ğŸ”„ ×”×¢×‘×¨ ×ª×•×¨ ×œ×§×‘×•×¦×” ×”×‘××”
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.GAME_OVER:
          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-900 rounded-3xl shadow-2xl mt-10 text-center border-4 border-yellow-500 animate-celebrate">
                            <h1 class="text-7xl font-black text-yellow-400 mb-4 drop-shadow-lg">ğŸ‰ × ×™×¦×—×•×Ÿ!!! ğŸ‰</h1>
                            <p class="text-3xl font-extrabold text-indigo-400 mb-6 border-b border-gray-700 pb-3">${getCurrentTeam().name} × ×™×¦×—×• ×‘××©×—×§!</p>
                            
                            <div class="bg-gray-700 p-6 rounded-2xl mb-6 shadow-inner border border-yellow-800">
                                <p class="text-2xl text-gray-300">× ×™×§×•×“ ×¡×•×¤×™:</p>
                                <p class="text-6xl font-black text-yellow-400">${getCurrentTeam().score}</p>
                            </div>

                            <!-- ×”×œ×—×¦×Ÿ ×ª×•×§×Ÿ ×œ×§×¨×•× ×œ×¤×•× ×§×¦×™×™×ª resetGame() -->
                            <button onclick="resetGame()" class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-2xl shadow-xl hover:from-indigo-700 hover:to-purple-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.98]">
                                ğŸ” ×”×ª×—×œ ××©×—×§ ×—×“×©
                            </button>
                        </div>
                    `;
          break;
      }

      appDiv.innerHTML = content;
      if (gameState.currentScreen === GAME_STATE.BOARD || gameState.currentScreen === GAME_STATE.SUMMARY) {
        renderBoard();
      }
    }

    // ×”×¤×¢×œ×ª ×”××¤×œ×™×§×¦×™×” ×œ××—×¨ ×˜×¢×™× ×ª ×”×“×£
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>

</html>
