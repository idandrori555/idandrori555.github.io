<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:;base64,=">
  <title>Alias - The Digital Game</title>
  <!-- טעינת Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- הגדרת פונט Inter גלובלי והתאמות בסיסיות ל-Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'celebrate': 'celebrate 1.5s ease-out infinite',
          },
          keyframes: {
            celebrate: {
              '0%, 100%': {
                transform: 'scale(1)',
                filter: 'drop-shadow(0 0 5px rgba(251, 191, 36, 0.5))'
              },
              '50%': {
                transform: 'scale(1.03)',
                filter: 'drop-shadow(0 0 15px rgba(251, 191, 36, 0.9))'
              },
            }
          }
        }
      }
    }
  </script>
  <style>
    /* הגדרת גלילה חלקה ותצוגת פונט */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0d121c;
      /* גוון כהה יותר - כחול-אפור עמוק */
      text-align: right;
      transition: background-color 0.5s ease;
    }

    .game-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    /* התאמה למכשירים ניידים */
    @media (max-width: 640px) {
      .main-word {
        font-size: 3.5rem;
        /* הגדלת המילה המרכזית במוביל */
      }
    }

    /* Hide arrows from number inputs */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    /* שיפור נגיעה והצללה לכפתורים */
    button {
      transition: all 0.2s ease-in-out;
    }

    /* --- אנימציות לשינוי ניקוד --- */

    @keyframes scoreUp {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }

      50% {
        transform: scale(1.15);
        opacity: 1;
        color: #4ade80;
        /* Tailwind green-400 */
        text-shadow: 0 0 10px rgba(74, 222, 128, 0.7);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes scoreDown {
      0% {
        transform: translate(0);
        opacity: 0.8;
      }

      25% {
        transform: translate(-5px, 0) scale(0.95);
        color: #f87171;
        /* Tailwind red-400 */
        text-shadow: 0 0 8px rgba(248, 113, 113, 0.7);
      }

      75% {
        transform: translate(5px, 0) scale(0.95);
      }

      100% {
        transform: translate(0);
        opacity: 1;
      }
    }

    .score-up {
      animation: scoreUp 0.5s ease-out;
    }

    .score-down {
      animation: scoreDown 0.5s ease-out;
    }
  </style>
</head>

<body class="bg-gray-950 text-gray-200">
  <div id="app" class="game-container">
    <!-- תוכן האפליקציה יטען כאן -->
  </div>

  <script src="hebrew_words.js"></script>
  <script>
    // הגדרת ברירת המחדל למשך סיבוב
    const DEFAULT_ROUND_DURATION = 60;

    // מצבי המשחק
    const GAME_STATE = {
      SETUP: 'SETUP',
      BOARD: 'BOARD',
      ROUND: 'ROUND',
      SUMMARY: 'SUMMARY',
      GAME_OVER: 'GAME_OVER',
      MANAGE_SETS: 'MANAGE_SETS'
    };

    // מצב המשחק הגלובלי
    let gameState = {
      currentScreen: GAME_STATE.SETUP,
      teams: [],
      currentTeamIndex: 0,
      winningScore: 70, // ניקוד הניצחון נכנס למצב המשחק
      roundDuration: DEFAULT_ROUND_DURATION, // משך הסיבוב המוגדר
      currentRound: {
        presenterIndex: 0,
        score: 0,
        timeLeft: DEFAULT_ROUND_DURATION,
        currentWord: '',
      },
      timerInterval: null,
      // totalWords מכיל את רשימת המילים שעדיין לא נעשה בהן שימוש במשחק הנוכחי.
      totalWords: [...HEBREW_WORDS],
      // שם ערכת המילים הפעילה
      activeWordSet: 'ברירת מחדל',
    };

    // --- ניהול ערכות מילים ב-LocalStorage ---

    const CUSTOM_SETS_STORAGE_KEY = 'aliasCustomWordSets';

    // קבלת כל הערכות המותאמות אישית מהאחסון
    function getCustomWordSets() {
      try {
        const sets = localStorage.getItem(CUSTOM_SETS_STORAGE_KEY);
        return sets ? JSON.parse(sets) : {};
      } catch (e) {
        console.error("Error reading custom word sets from localStorage", e);
        return {};
      }
    }

    // שמירת כל הערכות המותאמות אישית באחסון
    function saveCustomWordSets(sets) {
      try {
        localStorage.setItem(CUSTOM_SETS_STORAGE_KEY, JSON.stringify(sets));
      } catch (e) {
        console.error("Error saving custom word sets to localStorage", e);
      }
    }


    // --- לוגיקת אתחול ואימות קלט ---

    // אתחול האפליקציה והצגת מסך ההגדרות
    function initApp() {
      gameState.currentScreen = GAME_STATE.SETUP;
      render();
    }

    // איפוס מלא של מצב המשחק
    function resetGame() {
      // אם יש טיימר רץ, עצור אותו
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      // איפוס המצב תוך שמירה על הערכים האחרונים שהוגדרו (ניקוד ומשך סיבוב)
      gameState = {
        currentScreen: GAME_STATE.SETUP,
        teams: [],
        currentTeamIndex: 0,
        // שומרים על הערכים שהוגדרו לאחרונה או ברירת המחדל
        winningScore: gameState.winningScore || 70,
        roundDuration: gameState.roundDuration || DEFAULT_ROUND_DURATION,
        currentRound: {
          presenterIndex: 0,
          score: 0,
          // אתחול מחדש עם משך הסיבוב הנוכחי
          timeLeft: gameState.roundDuration || DEFAULT_ROUND_DURATION,
          currentWord: '',
        },
        timerInterval: null,
        totalWords: [...HEBREW_WORDS],
      };

      // עוברים למסך ההגדרות
      render();
    }

    // --- לוגיקת הגדרת משחק (SETUP) ---

    // אימות והתחלת המשחק
    function startSetup() {
      const teamNames = document.getElementById('teamNames');
      const winningScoreInput = document.getElementById('winningScore');
      const roundDurationInput = document.getElementById('roundDuration');
      const setupErrorElement = document.getElementById('setupError');
      const wordSetSelect = document.getElementById('wordSet');

      const selectedWordSet = wordSetSelect.value;
      let wordsForGame = [];

      if (selectedWordSet === 'ברירת מחדל') {
        wordsForGame = [...HEBREW_WORDS];
      } else {
        const customSets = getCustomWordSets();
        wordsForGame = [...(customSets[selectedWordSet] || [])];
      }

      if (wordsForGame.length === 0) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "ערכת המילים שנבחרה ריקה. אנא בחר ערכה אחרת או הוסף מילים.";
        return;
      }

      const namesArray = teamNames.value.split('\n').map(name => name.trim()).filter(name => name);
      const teamCount = namesArray.length;
      const scoreToWin = parseInt(winningScoreInput.value, 10);
      const duration = parseInt(roundDurationInput.value, 10);

      // אימות בסיסי
      if (teamCount < 2) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "אנא הזן לפחות 2 שמות של קבוצות (אחת לשורה).";
        return;
      }
      if (scoreToWin < 1 || isNaN(scoreToWin)) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "ניקוד הניצחון חייב להיות מספר חיובי.";
        return;
      }
      if (duration < 10 || isNaN(duration)) {
        setupErrorElement.style.display = 'block';
        setupErrorElement.textContent = "משך הסיבוב חייב להיות לפחות 10 שניות.";
        return;
      }

      setupErrorElement.textContent = "";

      gameState.winningScore = scoreToWin;
      gameState.roundDuration = duration;
      gameState.activeWordSet = selectedWordSet;
      gameState.totalWords = wordsForGame;

      // יצירת מערך הקבוצות
      gameState.teams = [];
      for (let i = 0; i < teamCount; i++) {
        gameState.teams.push({
          name: namesArray[i],
          score: 0,
          players: [`שחקן 1`, `שחקן 2`],
          presenterIndex: 0
        });
      }

      gameState.currentScreen = GAME_STATE.BOARD;
      render();
    }

    // --- לוגיקת לוח המשחק (BOARD) ---

    // הפעלת סיבוב חדש
    function startNewRound() {
      if (gameState.teams.length === 0) return;

      // אתחול נתוני הסיבוב
      gameState.currentRound.score = 0;
      // שימוש במשך הסיבוב המוגדר
      gameState.currentRound.timeLeft = gameState.roundDuration;
      gameState.currentWord = '';

      // הגדרת השחקן המציג הנוכחי
      const currentTeam = gameState.teams[gameState.currentTeamIndex];
      const nextPresenterIndex = currentTeam.presenterIndex;
      currentTeam.presenterIndex = (currentTeam.presenterIndex + 1) % currentTeam.players.length;

      gameState.currentScreen = GAME_STATE.ROUND;
      getNewWord();
      startTimer();
      render();
    }

    // --- לוגיקת סיבוב (ROUND) ---

    // בחירת מילה חדשה
    function getNewWord() {
      // 1. אם נגמרו כל המילים, מאפסים את המאגר (התחלת "משחק חדש" של מילים)
      if (gameState.totalWords.length === 0) {
        // במקרה של מאגר קטן, אנו מאפסים כדי לאפשר המשך משחק
        console.warn("Word pool exhausted. Resetting word list to master list.");
        gameState.totalWords = [...HEBREW_WORDS];
      }

      // 2. בחירת מילה אקראית מהמאגר שנותר
      const randomIndex = Math.floor(Math.random() * gameState.totalWords.length);
      const newWord = gameState.totalWords[randomIndex];

      // 3. הגדרת המילה הנוכחית
      gameState.currentRound.currentWord = newWord;

      // 4. הסרת המילה מהמאגר הגלובלי כדי למנוע שימוש חוזר במשחק זה
      gameState.totalWords.splice(randomIndex, 1);

      // 5. עדכון תצוגה
      if (gameState.currentScreen === GAME_STATE.ROUND) {
        const wordElement = document.getElementById('currentWordDisplay');
        if (wordElement) {
          wordElement.textContent = newWord;
        }
      }
    }

    // הפעלת שעון העצר
    function startTimer() {
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      gameState.timerInterval = setInterval(() => {
        gameState.currentRound.timeLeft--;
        const timerElement = document.getElementById('timerDisplay');
        if (timerElement) {
          timerElement.textContent = gameState.currentRound.timeLeft;

          // לוגיקה לשינוי צבע והבהוב כשהזמן נגמר
          if (gameState.currentRound.timeLeft <= 10) {
            timerElement.classList.add('text-red-400', 'animate-pulse');
            timerElement.classList.remove('text-indigo-400', 'text-gray-200');
          } else {
            timerElement.classList.remove('text-red-400', 'animate-pulse');
            timerElement.classList.add('text-indigo-400');
          }
        }

        if (gameState.currentRound.timeLeft <= 0) {
          clearInterval(gameState.timerInterval);
          endRound();
        }
      }, 1000);
    }

    // עדכון ניקוד במהלך הסיבוב
    function handleGuess(type) {
      const currentTeam = gameState.teams[gameState.currentTeamIndex];
      const roundScoreElement = document.getElementById('roundScoreDisplay');

      if (type === 'success') {
        gameState.currentRound.score++;
        currentTeam.score++; // עדכון מיידי של הניקוד הגלובלי להתקדמות בלוח

        // הפעלת אנימציית הצלחה
        if (roundScoreElement) {
          roundScoreElement.classList.remove('score-down', 'text-red-400', 'text-green-400');
          roundScoreElement.classList.add('score-up', 'text-green-400');
          setTimeout(() => {
            roundScoreElement.classList.remove('score-up');
            // עדכון צבע רגיל לאחר האנימציה, כדי לשמור על האדום אם הניקוד שלילי
            if (gameState.currentRound.score < 0) {
              roundScoreElement.classList.add('text-red-400');
            } else {
              roundScoreElement.classList.add('text-green-400');
            }
          }, 500); // משך האנימציה
        }

        getNewWord();
      } else if (type === 'skip') {
        // דילוג או פסילה מפחיתים נקודה (כולל ניקוד שלילי)
        gameState.currentRound.score--;
        currentTeam.score--;

        // הפעלת אנימציית כישלון
        if (roundScoreElement) {
          roundScoreElement.classList.remove('score-up', 'text-green-400', 'text-red-400');
          roundScoreElement.classList.add('score-down', 'text-red-400');
          setTimeout(() => {
            roundScoreElement.classList.remove('score-down');
            // עדכון צבע רגיל לאחר האנימציה
            if (gameState.currentRound.score < 0) {
              roundScoreElement.classList.add('text-red-400');
            } else {
              roundScoreElement.classList.add('text-green-400');
            }
          }, 500); // משך האנימציה
        }

        getNewWord();
      }

      // עדכון תצוגת ניקוד הסיבוב (חובה לפני בדיקת ניצחון/עדכון לוח)
      if (roundScoreElement) {
        roundScoreElement.textContent = gameState.currentRound.score;
      }


      // בדיקת ניצחון מיידי (אם הניקוד עבר את רף הניצחון)
      if (currentTeam.score >= gameState.winningScore) {
        clearInterval(gameState.timerInterval);
        gameState.currentScreen = GAME_STATE.GAME_OVER;
        render();
        return;
      }

      // עדכון תצוגת הלוח ברקע
      renderBoard();
    }

    // סיום הסיבוב
    function endRound() {
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      // בדיקת ניצחון
      const currentTeam = gameState.teams[gameState.currentTeamIndex];
      // בדיקת הניצחון לא משתנה - עדיין צריך לעבור את ניקוד הניצחון (חיובי)
      if (currentTeam.score >= gameState.winningScore) {
        gameState.currentScreen = GAME_STATE.GAME_OVER;
      } else {
        gameState.currentScreen = GAME_STATE.SUMMARY;
      }
      render();
    }

    // --- לוגיקת סיכום סיבוב (SUMMARY) וחילוף תור ---

    // העברת התור לקבוצה הבאה
    function nextTurn() {
      // אם יש רק קבוצה אחת (לא אמור לקרות בגלל האימות) או שהגענו לסוף, חוזרים להתחלה
      gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length;
      gameState.currentScreen = GAME_STATE.BOARD;
      render();
    }

    // --- פונקציות רינדור (Rendering) ---

    function getCurrentTeam() {
      return gameState.teams[gameState.currentTeamIndex];
    }

    // מעבר למסך ניהול ערכות
    function showManageSetsScreen() {
      gameState.currentScreen = GAME_STATE.MANAGE_SETS;
      render();
    }

    // שמירה או עדכון של ערכה
    function saveOrUpdateSet() {
      const setNameInput = document.getElementById('setName');
      const wordsTextarea = document.getElementById('wordsTextarea');
      const setName = setNameInput.value.trim();
      const words = wordsTextarea.value.split('\n').map(w => w.trim()).filter(Boolean);

      if (!setName || words.length === 0) {
        alert('יש לספק שם לערכה ולפחות מילה אחת.');
        return;
      }

      const customSets = getCustomWordSets();
      customSets[setName] = words;
      saveCustomWordSets(customSets);

      // חזרה למסך ההגדרות
      gameState.currentScreen = GAME_STATE.SETUP;
      render();
    }

    // מחיקת ערכה
    function deleteSet(setName) {
      if (!confirm(`האם אתה בטוח שברצונך למחוק את הערכה "${setName}"?`)) {
        return;
      }

      const customSets = getCustomWordSets();
      delete customSets[setName];
      saveCustomWordSets(customSets);

      // הישארו באותו מסך ורנדרו מחדש
      render();
    }

    // טעינת ערכה לעריכה
    function loadSetForEditing(setName) {
      const customSets = getCustomWordSets();
      const words = customSets[setName];

      if (words) {
        document.getElementById('setName').value = setName;
        document.getElementById('wordsTextarea').value = words.join('\n');
      }
    }

    // רינדור לוח המשחק (טבלת ניקוד)
    function renderBoard() {
      const boardContainer = document.getElementById('boardContainer');
      if (!boardContainer) return;

      const boardHTML = `
                <div class="space-y-4">
                    ${gameState.teams.map((team, index) => {
        // קביעת צבע הניקוד: צהוב לניצחון, אדום לשלילי, כחול לניקוד רגיל
        const scoreTextColor = team.score >= gameState.winningScore
          ? 'text-yellow-400'
          : (team.score < 0 ? 'text-red-400' : 'text-blue-400');

        return `
                        <div class="flex items-center justify-between p-5 rounded-xl shadow-xl transition duration-300 ${index === gameState.currentTeamIndex ? 'bg-indigo-900/50 border-4 border-indigo-400 transform scale-[1.02] shadow-indigo-500/50' : 'bg-gray-800 border border-gray-700 hover:bg-gray-700/50'}">
                            <div class="flex flex-col">
                                <span class="text-xl font-bold ${index === gameState.currentTeamIndex ? 'text-indigo-300' : 'text-gray-300'}">${team.name}</span>
                                <span class="text-sm text-gray-400 mt-1">המציג הבא: ${team.players[team.presenterIndex]}</span>
                            </div>
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <span class="text-4xl font-extrabold ${scoreTextColor}">${team.score}</span>
                            </div>
                        </div>
                      `;
      }).join('')}
                </div>
            `;
      boardContainer.innerHTML = boardHTML;
    }


    // רינדור בהתאם למצב המשחק
    function render() {
      const appDiv = document.getElementById('app');
      let content = '';

      const currentTeam = getCurrentTeam();
      const nextPresenterName = currentTeam ? currentTeam.players[currentTeam.presenterIndex] : '';

      switch (gameState.currentScreen) {
        case GAME_STATE.SETUP:
          const customSets = getCustomWordSets();
          const setNames = Object.keys(customSets);

          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10">
                            <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400 mb-8 text-center border-b border-gray-700 pb-3">
                                אליאס
                            </h1>
                            
                            <div class="space-y-6">
                                <!-- בחירת ערכת מילים -->
                                <div class="mb-4">
                                    <label for="wordSet" class="block text-sm font-medium text-gray-300 mb-2">בחר ערכת מילים:</label>
                                    <div class="flex gap-2">
                                        <select id="wordSet" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white">
                                            <option value="ברירת מחדל">ברירת מחדל (עברית)</option>
                                            ${setNames.map(name => `<option value="${name}" ${gameState.activeWordSet === name ? 'selected' : ''}>${name}</option>`).join('')}
                                        </select>
                                        <button onclick="showManageSetsScreen()" class="p-3 bg-gray-600 text-white rounded-xl hover:bg-gray-500 transition duration-200" title="נהל ערכות מילים">⚙️</button>
                                    </div>
                                </div>

                                <!-- ניקוד נדרש לניצחון -->
                                <div class="mb-4">
                                    <label for="winningScore" class="block text-sm font-medium text-gray-300 mb-2">ניקוד נדרש לניצחון:</label>
                                    <input type="number" id="winningScore" value="${gameState.winningScore}" min="1" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white" aria-label="ניקוד נדרש לניצחון">
                                </div>
                                
                                <!-- משך סיבוב -->
                                <div class="mb-4">
                                    <label for="roundDuration" class="block text-sm font-medium text-gray-300 mb-2">משך סיבוב (שניות):</label>
                                    <input type="number" id="roundDuration" value="${gameState.roundDuration}" min="10" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white" aria-label="משך סיבוב בשניות">
                                </div>

                                <!-- שמות הקבוצות -->
                                <div class="mb-6">
                                    <label for="teamNames" class="block text-sm font-medium text-gray-300 mb-2">שמות הקבוצות (הזן שם אחד בכל שורה):</label>
                                    <textarea id="teamNames" rows="4" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-inner text-white placeholder-gray-400" placeholder="קבוצת הפנתרים\nקבוצת הנמרים" aria-label="שמות הקבוצות"></textarea>
                                </div>
                            </div>

                            <p id="setupError" class="text-red-400 text-sm font-semibold mb-6 text-center bg-red-900/30 p-2 rounded-lg hidden"></p>
                            
                            <button onclick="startSetup()" class="w-full py-4 my-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-2xl shadow-lg hover:from-indigo-700 hover:to-purple-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.98] ring-2 ring-indigo-400">
                                התחל משחק
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.MANAGE_SETS:
          const existingSets = getCustomWordSets();
          content = `
            <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10">
              <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-cyan-400 mb-6 text-center border-b border-gray-700 pb-3">
                ניהול ערכות מילים
              </h1>

              <!-- רשימת ערכות קיימות -->
              <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-300 mb-3">הערכות שלי</h2>
                <div class="space-y-2">
                  ${Object.keys(existingSets).length > 0 ? Object.keys(existingSets).map(setName => `
                    <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                      <span class="font-semibold text-white">${setName}</span>
                      <div class="flex gap-2">
                        <button onclick="loadSetForEditing('${setName}')" class="text-sm bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded-md transition">ערוך</button>
                        <button onclick="deleteSet('${setName}')" class="text-sm bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-md transition">מחק</button>
                      </div>
                    </div>
                  `).join('') : '<p class="text-gray-400 text-center">עדיין לא יצרת ערכות מילים.</p>'}
                </div>
              </div>

              <!-- טופס יצירה/עריכה -->
              <div class="space-y-4 pt-4 border-t border-gray-700">
                <h2 class="text-xl font-bold text-gray-300">יצירה / עריכת ערכה</h2>
                <div>
                  <label for="setName" class="block text-sm font-medium text-gray-300 mb-2">שם הערכה:</label>
                  <input type="text" id="setName" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-xl focus:ring-teal-500 focus:border-teal-500 text-white" placeholder="לדוגמה: סרטים וסדרות">
                </div>
                <div>
                  <label for="wordsTextarea" class="block text-sm font-medium text-gray-300 mb-2">רשימת מילים (אחת בכל שורה):</label>
                  <textarea id="wordsTextarea" rows="6" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-xl focus:ring-teal-500 focus:border-teal-500 text-white" placeholder="הארי פוטר\nשר הטבעות\n..."></textarea>
                </div>
                <button onclick="saveOrUpdateSet()" class="w-full py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold rounded-xl shadow-lg hover:from-teal-600 hover:to-cyan-600 transition">
                  שמור ערכה
                </button>
              </div>
              
              <button onclick="initApp()" class="w-full mt-6 py-2 bg-gray-600 text-gray-200 font-semibold rounded-xl hover:bg-gray-500 transition">
                חזור למסך הראשי
              </button>
            </div>
          `;
          break;

        case GAME_STATE.BOARD:
          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10">
                            <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-400 mb-6 text-center">🏆 לוח המשחק הדיגיטלי</h1>
                            
                            <div class="bg-indigo-900 p-5 rounded-2xl mb-8 border-l-8 border-indigo-400 shadow-xl shadow-indigo-900/50">
                                <p class="text-md text-indigo-300 font-medium">תור נוכחי:</p>
                                <p class="text-3xl font-black text-indigo-200">${currentTeam.name}</p>
                                <p class="text-md text-gray-300 mt-2">המציג הבא: <span class="font-semibold text-white">${currentTeam.players[currentTeam.presenterIndex]}</span></p>
                            </div>

                            <h2 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">ניקוד (יעד: ${gameState.winningScore})</h2>
                            <div id="boardContainer" class="mb-8">
                                <!-- הלוח נטען באמצעות renderBoard() -->
                            </div>
                            
                            <button onclick="startNewRound()" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white font-extrabold rounded-2xl shadow-xl hover:from-emerald-600 hover:to-green-600 transition duration-300 transform hover:scale-[1.02] active:scale-[0.98] ring-4 ring-emerald-300/50">
                                🚀 התחל סיבוב חדש (משך: ${gameState.roundDuration} שניות)
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.ROUND:
          content = `
                        <div class="w-full max-w-lg p-6 bg-gray-900 border border-gray-700 rounded-3xl shadow-2xl mt-10 text-center">
                            <h1 class="text-2xl font-extrabold text-indigo-400 mb-4">תור של: ${currentTeam.name}</h1>
                            
                            <div class="grid grid-cols-2 gap-4 mb-6 p-4 bg-gray-800 rounded-2xl shadow-inner border border-gray-700">
                                <div class="p-2 border-l border-gray-700">
                                    <p class="text-base font-medium text-gray-400">זמן שנותר:</p>
                                    <p id="timerDisplay" class="text-6xl font-black text-indigo-400 transition-colors duration-200">${gameState.currentRound.timeLeft}</p>
                                </div>
                                <div class="p-2">
                                    <p class="text-base font-medium text-gray-400">ניקוד בסיבוב:</p>
                                    <p id="roundScoreDisplay" class="text-6xl font-black ${gameState.currentRound.score < 0 ? 'text-red-400' : 'text-green-400'}">${gameState.currentRound.score}</p>
                                </div>
                            </div>
                            
                            <div class="my-8 p-10 bg-gradient-to-br from-indigo-700 to-purple-700 text-white rounded-3xl shadow-2xl transform hover:scale-105 transition duration-300 cursor-pointer shadow-indigo-500/50">
                                <p class="text-xl font-medium opacity-80 mb-2">המילה להסבר:</p>
                                <p id="currentWordDisplay" class="main-word text-6xl md:text-8xl font-black tracking-wider">${gameState.currentRound.currentWord}</p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="handleGuess('success')" class="py-6 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-extrabold text-2xl rounded-2xl shadow-2xl hover:from-green-600 hover:to-emerald-600 transition duration-300 transform hover:scale-[1.05] active:scale-[1] ring-2 ring-green-300/50">
                                    הצליח
                                </button>
                                <button onclick="handleGuess('skip')" class="py-6 bg-gradient-to-r from-red-500 to-pink-500 text-white font-extrabold text-2xl rounded-2xl shadow-2xl hover:from-red-600 hover:to-pink-600 transition duration-300 transform hover:scale-[1.05] active:scale-[1] ring-2 ring-red-300/50">
                                    דילוג / פסילה
                                </button>
                            </div>

                            <button onclick="endRound()" class="w-full mt-6 py-3 bg-gray-700 text-gray-300 font-bold rounded-2xl hover:bg-gray-600 transition duration-300 shadow-md transform hover:scale-[1.01] active:scale-[0.99]">
                                סיים סיבוב מוקדם
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.SUMMARY:
          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-800 border border-gray-700 rounded-3xl shadow-2xl mt-10 text-center">
                            <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400 mb-6 border-b border-gray-700 pb-2">🏁 סיכום סיבוב!</h1>
                            
                            <div class="bg-gray-700 p-8 rounded-2xl mb-8 shadow-xl border-t-4 ${gameState.currentRound.score < 0 ? 'border-red-500' : 'border-green-500'}">
                                <p class="text-xl text-gray-300 mb-3">הקבוצה ששיחקה: <span class="font-black text-indigo-400">${currentTeam.name}</span></p>
                                <p class="text-2xl font-bold text-gray-300 mb-4">ניקוד שנוסף בסיבוב:</p>
                                <p class="text-8xl font-black ${gameState.currentRound.score < 0 ? 'text-red-400' : 'text-green-400'}">${gameState.currentRound.score}</p>
                            </div>

                            <h2 class="text-xl font-bold text-gray-300 mb-4 border-b border-gray-700 pb-2">התקדמות הלוח</h2>
                            <div id="boardContainer" class="mb-8">
                                <!-- הלוח נטען באמצעות renderBoard() -->
                            </div>

                            <button onclick="nextTurn()" class="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold rounded-2xl shadow-xl hover:from-blue-700 hover:to-cyan-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.98]">
                                🔄 העבר תור לקבוצה הבאה
                            </button>
                        </div>
                    `;
          break;

        case GAME_STATE.GAME_OVER:
          content = `
                        <div class="w-full max-w-lg p-8 bg-gray-900 rounded-3xl shadow-2xl mt-10 text-center border-4 border-yellow-500 animate-celebrate">
                            <h1 class="text-7xl font-black text-yellow-400 mb-4 drop-shadow-lg">🎉 ניצחון!!! 🎉</h1>
                            <p class="text-3xl font-extrabold text-indigo-400 mb-6 border-b border-gray-700 pb-3">${getCurrentTeam().name} ניצחו במשחק!</p>
                            
                            <div class="bg-gray-700 p-6 rounded-2xl mb-6 shadow-inner border border-yellow-800">
                                <p class="text-2xl text-gray-300">ניקוד סופי:</p>
                                <p class="text-6xl font-black text-yellow-400">${getCurrentTeam().score}</p>
                            </div>

                            <!-- הלחצן תוקן לקרוא לפונקציית resetGame() -->
                            <button onclick="resetGame()" class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-2xl shadow-xl hover:from-indigo-700 hover:to-purple-700 transition duration-300 transform hover:scale-[1.01] active:scale-[0.98]">
                                🔁 התחל משחק חדש
                            </button>
                        </div>
                    `;
          break;
      }

      appDiv.innerHTML = content;
      if (gameState.currentScreen === GAME_STATE.BOARD || gameState.currentScreen === GAME_STATE.SUMMARY) {
        renderBoard();
      }
    }

    // הפעלת האפליקציה לאחר טעינת הדף
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>

</html>
